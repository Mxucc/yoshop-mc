import{W as e,S as t,X as o,o as a,c as s,w as l,a as n,f as d,t as i,e as c,k as u,i as r,l as m,b as g,d as p,F as f,N as _,L as h,M as k,g as y,B as C,r as v,q as S,$ as x,n as b,j as w,x as I,Y as T,u as P,v as L,T as B}from"./index-BRq6JGeD.js";import{_ as V}from"./mp-html.ClMv_aOj.js";import{r as N}from"./uni-app.es.eRxYrI1e.js";import{d as M}from"./index.Dyev38lT.js";import{a as j,t as A}from"./cart.B3GP1kqe.js";import{G as $,h as E,a as U}from"./index.CD8gkcm5.js";import{_ as H}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{C as D}from"./index.BoxyUShw.js";import{l as G,_ as O}from"./comment.DT4b30DU.js";import{A as R}from"./index.BoOOWpNQ.js";import{_ as W}from"./u-popup.DsqHvHAu.js";import"./u-icon.BjjpM4cq.js";const q={name:"ShareSheet",components:{},emits:["update:modelValue"],props:{modelValue:{Type:Boolean,default:!1},cancelWithMask:{type:Boolean,default:!0},shareTitle:{type:String,default:"商品分享"},shareImageUrl:{type:String,default:""},cancelText:{type:String,default:"关闭"}},data:()=>({}),created(){this.initSharesheet()},methods:{initSharesheet(){},onMaskClick(){this.cancelWithMask&&this.handleCancel()},getShareUrl(){const{path:a,query:s}=e();return new Promise(((e,l)=>{t.h5Url().then((t=>{const l=o(t,a,s);e(l)}))}))},handleCopyLink(){const e=this;e.getShareUrl().then((t=>{uni.setClipboardData({data:t,success:()=>e.$toast("链接复制成功，快去发送给朋友吧~"),fail:({errMsg:t})=>e.$toast("复制失败 "+t),complete:()=>e.handleCancel()})}))},handleCancel(){this.$emit("update:modelValue",!1)}}};const Q={components:{GoodsSkuPopup:$},emits:["update:modelValue"],props:{modelValue:{Type:Boolean,default:!1},skuMode:{type:Number,default:1},goods:{type:Object,default:{}}},data:()=>({goodsInfo:{},maxBuyNum:null}),computed:{activedBtnBackgroundColor(){return E(this.appTheme.mainBg,.1)}},created(){const e=this,{goods:t}=e;e.goodsInfo={_id:t.goods_id,name:t.goods_name,goods_thumb:t.goods_image,sku_list:e.getSkuList(),spec_list:e.getSpecList()},e.maxBuyNum=e.getMaxBuyNum()},methods:{onChangeValue(e){this.$emit("update:modelValue",e)},getSkuList(){const e=this,{goods:{goods_name:t,goods_image:o,skuList:a}}=e,s=[];return a.forEach((a=>{s.push({_id:a.id,goods_sku_id:a.goods_sku_id,goods_id:a.goods_id,goods_name:t,image:a.image_url?a.image_url:o,price:100*a.goods_price,stock:a.stock_num,spec_value_ids:a.spec_value_ids,sku_name_arr:e.getSkuNameArr(a.spec_value_ids)})})),s},getSkuNameArr(e){const t=this,o=[];return e&&e.forEach(((e,a)=>{const s=t.getSpecValueName(e,a);o.push(s)})),o.length?o:["默认"]},getSpecValueName(e,t){const{goods:{specList:o}}=this;return o[t].valueList.find((t=>t.spec_value_id==e)).spec_value},getSpecList(){const{goods:{specList:e}}=this,t=[];return e.forEach((e=>{const o=[];e.valueList.forEach((e=>{o.push({name:e.spec_value})})),t.push({name:e.spec_name,list:o})})),t.length?t:[{name:"默认",list:[{name:"默认"}]}]},getMaxBuyNum(){const{goods:e}=this;return e.is_restrict?e.restrict_single:null},openSkuPopup(){},closeSkuPopup(){},addCart(e){const t=this,{goods_id:o,goods_sku_id:a,buy_num:s}=e;j(o,a,s).then((e=>{t.$toast(e.message),t.onChangeValue(!1);const o=e.data.cartTotal;C(o),t.$emit("addCart",o)}))},buyNow(e){this.$navTo("pages/checkout/index",{mode:"buyNow",goodsId:e.goods_id,goodsSkuId:e.goods_sku_id,goodsNum:e.buy_num}),this.onChangeValue(!1)}}};const Y="goods.service/list";const F=H({components:{ShareSheet:H(q,[["render",function(e,t,o,g,p,f){const _=r,h=m;return a(),s(_,{class:u(["sharesheet",{show:o.modelValue}])},{default:l((()=>[n(_,{class:"mask-class sharesheet__mask",onClick:f.onMaskClick},null,8,["onClick"]),n(_,{class:"sharesheet__container"},{default:l((()=>[n(_,{class:"sharesheet__list"},{default:l((()=>[n(_,{class:"share-item",onClick:t[0]||(t[0]=e=>f.handleCopyLink())},{default:l((()=>[n(_,{class:"item-image",style:{backgroundColor:"#38beec"}},{default:l((()=>[n(h,{class:"iconfont icon-link"})])),_:1}),n(_,{class:"item-name"},{default:l((()=>[n(h,null,{default:l((()=>[d("复制链接")])),_:1})])),_:1})])),_:1})])),_:1}),o.cancelText?(a(),s(_,{key:0,class:"sharesheet__footer",onClick:t[1]||(t[1]=e=>f.handleCancel())},{default:l((()=>[n(_,{class:"btn-cancel"},{default:l((()=>[d(i(o.cancelText),1)])),_:1})])),_:1})):c("",!0)])),_:1})])),_:1},8,["class"])}],["__scopeId","data-v-4d0565c5"]]),CustomerBtn:D,SlideImage:H({props:{video:{type:Object,default:()=>null},videoCover:{type:Object,default:()=>null},images:{type:Array,default:[]}},data:()=>({indicatorDots:!0,autoplay:!0,interval:4e3,duration:800,currentIndex:1}),methods:{onVideoPlay(e){this.autoplay=!1},setCurrent({detail:e}){this.currentIndex=e.current+1},onPreviewImages(e){const t=[];this.images.forEach((e=>{t.push(e.preview_url)})),uni.previewImage({current:t[e],urls:t})}}},[["render",function(e,t,o,u,C,v){const S=_,x=r,b=h,w=y,I=k,T=m;return a(),s(x,{class:"images-swiper"},{default:l((()=>[n(I,{class:"swiper-box",autoplay:C.autoplay,duration:C.duration,"indicator-dots":C.indicatorDots,interval:C.interval,circular:!0,onChange:v.setCurrent},{default:l((()=>[o.video?(a(),s(b,{key:0},{default:l((()=>[n(x,{class:"slide-video"},{default:l((()=>[n(S,{id:"myVideo",class:"video",poster:o.videoCover?o.videoCover.preview_url:"",src:o.video.external_url,controls:"","x5-playsinline":"",playsinline:"","x5-video-player-type":"h5","x5-video-player-fullscreen":"","x5-video-orientation":"portrait","enable-progress-gesture":!1,onPlay:v.onVideoPlay},null,8,["poster","src","onPlay"])])),_:1})])),_:1})):c("",!0),(a(!0),g(f,null,p(o.images,((e,t)=>(a(),s(b,{key:t,onClick:e=>v.onPreviewImages(t)},{default:l((()=>[n(x,{class:"slide-image"},{default:l((()=>[n(w,{class:"image",draggable:!1,src:e.preview_url},null,8,["src"])])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1},8,["autoplay","duration","indicator-dots","interval","onChange"]),n(x,{class:"swiper-count"},{default:l((()=>[n(T,null,{default:l((()=>[d(i(C.currentIndex),1)])),_:1}),n(T,null,{default:l((()=>[d("/")])),_:1}),n(T,null,{default:l((()=>[d(i(o.images.length+(o.video?1:0)),1)])),_:1})])),_:1})])),_:1})}],["__scopeId","data-v-e087397a"]]),SkuPopup:H(Q,[["render",function(e,t,o,l,n,d){const i=v("goods-sku-popup");return a(),s(i,{modelValue:o.modelValue,onInput:d.onChangeValue,"border-radius":"20",localdata:n.goodsInfo,mode:o.skuMode,maskCloseAble:!0,priceColor:e.appTheme.mainBg,buyNowBackgroundColor:e.appTheme.mainBg,addCartColor:e.appTheme.viceText,addCartBackgroundColor:e.appTheme.viceBg,activedStyle:{color:e.appTheme.mainBg,borderColor:e.appTheme.mainBg,backgroundColor:d.activedBtnBackgroundColor},onOpen:d.openSkuPopup,onClose:d.closeSkuPopup,onAddCart:d.addCart,onBuyNow:d.buyNow,buyNowText:"立即购买",maxBuyNum:n.maxBuyNum},null,8,["modelValue","onInput","localdata","mode","priceColor","buyNowBackgroundColor","addCartColor","addCartBackgroundColor","activedStyle","onOpen","onClose","onAddCart","onBuyNow","maxBuyNum"])}]]),Comment:H({components:{AvatarImage:R},props:{goodsId:{type:Number,default:null},limit:{type:Number,default:2}},data:()=>({isLoading:!0,rates:{10:5,20:3,30:1},list:[],total:0}),created(){this.getCommentList()},methods:{getCommentList(){const e=this;e.isLoading=!0,G(e.goodsId,e.limit).then((t=>{e.list=t.data.list,e.total=t.data.total})).catch((e=>e)).finally((()=>e.isLoading=!1))},onTargetToComment(){this.$navTo("pages/comment/index",{goodsId:this.goodsId})}}},[["render",function(e,t,o,u,_,h){const k=m,y=r,C=v("avatar-image"),x=N(S("u-rate"),O);return!_.isLoading&&_.list.length?(a(),s(y,{key:0,class:"goods-comment m-top20"},{default:l((()=>[n(y,{class:"item-title dis-flex"},{default:l((()=>[n(y,{class:"block-left flex-box"},{default:l((()=>[d(" 商品评价 ("),n(k,{class:"total"},{default:l((()=>[d(i(_.total)+"条",1)])),_:1}),d(") ")])),_:1}),n(y,{class:"block-right"},{default:l((()=>[n(k,{onClick:h.onTargetToComment,class:"show-more col-9"},{default:l((()=>[d("查看更多")])),_:1},8,["onClick"]),n(k,{class:"iconfont icon-arrow-right col-9"})])),_:1})])),_:1}),n(y,{class:"comment-list"},{default:l((()=>[(a(!0),g(f,null,p(_.list,((e,t)=>(a(),s(y,{class:"comment-item",key:t},{default:l((()=>[n(y,{class:"comment-item_row dis-flex flex-y-center"},{default:l((()=>[n(y,{class:"user-info dis-flex flex-y-center"},{default:l((()=>[n(y,{class:"user-avatar"},{default:l((()=>[n(C,{url:e.user.avatar_url,width:50},null,8,["url"])])),_:2},1024),n(k,{class:"user-name"},{default:l((()=>[d(i(e.user.nick_name),1)])),_:2},1024)])),_:2},1024),n(y,{class:"star-rating"},{default:l((()=>[n(x,{"active-color":"#f4a213",current:_.rates[e.score],disabled:!0},null,8,["current"])])),_:2},1024)])),_:2},1024),n(y,{class:"item-content m-top20"},{default:l((()=>[n(k,{class:"f-26 twoline-hide"},{default:l((()=>[d(i(e.content),1)])),_:2},1024)])),_:2},1024),n(y,{class:"comment-time"},{default:l((()=>[d(i(e.create_time),1)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1})):c("",!0)}],["__scopeId","data-v-a965c97b"]]),Service:H({props:{goodsId:{type:Number,default:null}},data:()=>({isLoading:!0,showPopup:!1,list:[]}),created(){this.getServiceList()},methods:{getServiceList(){const e=this;var t;e.isLoading=!0,(t=e.goodsId,x.get(Y,{goodsId:t})).then((t=>e.list=t.data.list)).finally((()=>e.isLoading=!1))},handlePopup(){this.showPopup=!this.showPopup}}},[["render",function(e,t,o,u,_,h){const k=m,y=r,C=w,v=N(S("u-popup"),W);return _.list.length?(a(),s(y,{key:0,class:"service-wrapper",style:b(e.appThemeStyle)},{default:l((()=>[n(y,{class:"service-simple",onClick:h.handlePopup},{default:l((()=>[n(y,{class:"s-list"},{default:l((()=>[(a(!0),g(f,null,p(_.list,((e,t)=>(a(),s(y,{class:"s-item",key:t},{default:l((()=>[n(k,{class:"item-icon iconfont icon-fuwu"}),n(k,{class:"item-val"},{default:l((()=>[d(i(e.name),1)])),_:2},1024)])),_:2},1024)))),128))])),_:1}),n(y,{class:"s-arrow f-26 col-9 t-r"},{default:l((()=>[n(k,{class:"iconfont icon-arrow-right"})])),_:1})])),_:1},8,["onClick"]),n(v,{modelValue:_.showPopup,"onUpdate:modelValue":t[0]||(t[0]=e=>_.showPopup=e),mode:"bottom",closeable:!0,"border-radius":26},{default:l((()=>[n(y,{class:"service-content"},{default:l((()=>[n(y,{class:"title"},{default:l((()=>[d("服务")])),_:1}),n(C,{class:"content-scroll","scroll-y":!0},{default:l((()=>[n(y,{class:"s-list clearfix"},{default:l((()=>[(a(!0),g(f,null,p(_.list,((e,t)=>(a(),s(y,{class:"s-item",key:t},{default:l((()=>[n(k,{class:"item-icon iconfont icon-fuwu"}),n(y,{class:"item-val"},{default:l((()=>[d(i(e.name),1)])),_:2},1024),n(y,{class:"item-summary"},{default:l((()=>[d(i(e.summary),1)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1},8,["style"])):c("",!0)}],["__scopeId","data-v-32db66c3"]])},data:()=>({isLoading:!0,goodsId:null,goods:{},cartTotal:0,showSkuPopup:!1,skuMode:1,showShareSheet:!1,isEnableCart:!1,isShowCustomerBtn:!1,activeTabIndex:0}),computed:{pagePath(){return`/pages/goods/detail?${this.$getShareUrlParams({goodsId:this.goodsId})}`}},async onLoad(e){this.onRecordQuery(e),this.onRefreshPage(),this.isShowCustomerBtn=await I.isShowCustomerBtn()},methods:{decodeHtml:e=>e||"",onRecordQuery(e){const t=T(e);this.goodsId=e.goodsId?parseInt(e.goodsId):parseInt(t.gid)},onRefreshPage(){const e=this;e.isLoading=!0,Promise.all([e.getGoodsDetail(),e.getCartTotal()]).finally((()=>e.isLoading=!1))},getGoodsDetail(){const e=this;return new Promise(((t,o)=>{M(e.goodsId).then((o=>{e.goods=o.data.detail,e.goods.goods_type==U.PHYSICAL.value&&(e.isEnableCart=!0),t(o)})).catch(o)}))},getCartTotal(){const e=this;return new Promise(((t,o)=>{A().then((o=>{e.cartTotal=o.data.cartTotal,t(o)})).catch(o)}))},onAddCart(e){this.cartTotal=e},onShowSkuPopup(e=1){const t=this;t.isEnableCart?t.skuMode=e:t.skuMode=3,t.showSkuPopup=!t.showSkuPopup},onShowShareSheet(){this.showShareSheet=!this.showShareSheet},onTargetHome(e){this.$navTo("pages/index/index")},onTargetCart(){this.$navTo("pages/cart/index")}},onShareAppMessage(){return{title:this.goods.goods_name,path:this.pagePath}},onShareTimeline(){return{title:this.goods.goods_name,path:this.pagePath}}},[["render",function(e,t,o,_,h,k){const y=v("SlideImage"),C=m,x=r,w=B,I=v("Service"),T=v("SkuPopup"),M=v("Comment"),j=N(S("mp-html"),V),A=v("customer-btn"),$=v("share-sheet");return P((a(),s(x,{class:"container",style:b(e.appThemeStyle)},{default:l((()=>[h.isLoading?c("",!0):(a(),s(y,{key:0,video:h.goods.video,videoCover:h.goods.videoCover,images:h.goods.goods_images},null,8,["video","videoCover","images"])),h.isLoading?c("",!0):(a(),s(x,{key:1,class:"goods-info m-top20"},{default:l((()=>[n(x,{class:"info-item info-item__top dis-flex flex-x-between flex-y-end"},{default:l((()=>[n(x,{class:"block-left dis-flex flex-y-center"},{default:l((()=>[n(C,{class:"floor-price__samll"},{default:l((()=>[d("￥")])),_:1}),n(C,{class:"floor-price"},{default:l((()=>[d(i(h.goods.goods_price_min),1)])),_:1}),h.goods.is_user_grade?(a(),s(x,{key:0,class:"user-grade"},{default:l((()=>[n(C,null,{default:l((()=>[d("会员价")])),_:1})])),_:1})):c("",!0),h.goods.line_price_min>0?(a(),s(C,{key:1,class:"original-price"},{default:l((()=>[d("￥"+i(h.goods.line_price_min),1)])),_:1})):c("",!0)])),_:1}),n(x,{class:"block-right dis-flex"},{default:l((()=>[n(x,{class:"goods-sales"},{default:l((()=>[n(C,null,{default:l((()=>[d("已售"+i(h.goods.goods_sales)+"件",1)])),_:1})])),_:1})])),_:1})])),_:1}),n(x,{class:"info-item info-item__name dis-flex flex-y-center"},{default:l((()=>[n(x,{class:"goods-name flex-box"},{default:l((()=>[n(C,{class:"twoline-hide"},{default:l((()=>[d(i(h.goods.goods_name),1)])),_:1})])),_:1}),n(x,{class:"goods-share__line"}),n(x,{class:"goods-share"},{default:l((()=>[n(w,{class:"share-btn dis-flex flex-dir-column",onClick:t[0]||(t[0]=e=>k.onShowShareSheet())},{default:l((()=>[n(C,{class:"share__icon iconfont icon-fenxiang"}),n(C,{class:"f-24"},{default:l((()=>[d("分享")])),_:1})])),_:1})])),_:1})])),_:1}),h.goods.selling_point?(a(),s(x,{key:0,class:"info-item info-item_selling-point"},{default:l((()=>[n(C,null,{default:l((()=>[d(i(h.goods.selling_point),1)])),_:1})])),_:1})):c("",!0)])),_:1})),20==h.goods.spec_type?(a(),s(x,{key:2,class:"goods-choice m-top20 b-f",onClick:t[1]||(t[1]=e=>k.onShowSkuPopup(1))},{default:l((()=>[n(x,{class:"spec-list"},{default:l((()=>[n(x,{class:"flex-box"},{default:l((()=>[n(C,{class:"col-8"},{default:l((()=>[d("选择：")])),_:1}),(a(!0),g(f,null,p(h.goods.specList,((e,t)=>(a(),s(C,{class:"spec-name",key:t},{default:l((()=>[d(i(e.spec_name),1)])),_:2},1024)))),128))])),_:1}),n(x,{class:"f-26 col-9 t-r"},{default:l((()=>[n(C,{class:"iconfont icon-arrow-right"})])),_:1})])),_:1})])),_:1})):c("",!0),h.isLoading?c("",!0):(a(),s(I,{key:3,"goods-id":h.goodsId},null,8,["goods-id"])),h.isLoading?c("",!0):(a(),s(T,{key:4,modelValue:h.showSkuPopup,"onUpdate:modelValue":t[2]||(t[2]=e=>h.showSkuPopup=e),skuMode:h.skuMode,goods:h.goods,onAddCart:k.onAddCart},null,8,["modelValue","skuMode","goods","onAddCart"])),h.isLoading?c("",!0):(a(),s(M,{key:5,"goods-id":h.goodsId,limit:2},null,8,["goods-id"])),h.isLoading?c("",!0):(a(),s(x,{key:6,class:"goods-content m-top20"},{default:l((()=>[n(x,{class:"item-title b-f"},{default:l((()=>[n(C,null,{default:l((()=>[d("商品描述")])),_:1})])),_:1}),h.goods.content?(a(),s(x,{key:0,class:"goods-content__detail b-f"},{default:l((()=>[h.goods.content.text?(a(),s(x,{key:0,class:"content-fixed"},{default:l((()=>[n(j,{content:k.decodeHtml(h.goods.content.text)},null,8,["content"])])),_:1})):c("",!0),h.goods.content.list&&h.goods.content.list.length?(a(),s(x,{key:1,class:"content-tabs"},{default:l((()=>[(a(!0),g(f,null,p(h.goods.content.list,((e,t)=>(a(),s(x,{key:t,class:u(["tab-item",{active:h.activeTabIndex===t}]),onClick:e=>h.activeTabIndex=t},{default:l((()=>[d(i(e.title||"详情"),1)])),_:2},1032,["class","onClick"])))),128))])),_:1})):c("",!0),h.goods.content.list&&h.goods.content.list.length?(a(),s(x,{key:2,class:"content-section"},{default:l((()=>[n(j,{content:k.decodeHtml(h.goods.content.list[h.activeTabIndex].content)},null,8,["content"])])),_:1})):c("",!0),h.goods.content.end?(a(),s(x,{key:3,class:"content-end"},{default:l((()=>[n(j,{content:k.decodeHtml(h.goods.content.end)},null,8,["content"])])),_:1})):c("",!0)])),_:1})):c("",!0)])),_:1})),n(x,{class:"footer-fixed"},{default:l((()=>[n(x,{class:"footer-container"},{default:l((()=>[n(x,{class:"foo-item-fast"},{default:l((()=>[n(x,{class:"fast-item fast-item--home",onClick:k.onTargetHome},{default:l((()=>[n(x,{class:"fast-icon"},{default:l((()=>[n(C,{class:"iconfont icon-shouye"})])),_:1}),n(x,{class:"fast-text"},{default:l((()=>[n(C,null,{default:l((()=>[d("首页")])),_:1})])),_:1})])),_:1},8,["onClick"]),h.isShowCustomerBtn?(a(),s(A,{key:0,showCard:!0,cardTitle:h.goods.goods_name,cardImage:h.goods.goods_image,cardPath:k.pagePath},{default:l((()=>[n(x,{class:"fast-item"},{default:l((()=>[n(x,{class:"fast-icon"},{default:l((()=>[n(C,{class:"iconfont icon-kefu1"})])),_:1}),n(x,{class:"fast-text"},{default:l((()=>[n(C,null,{default:l((()=>[d("客服")])),_:1})])),_:1})])),_:1})])),_:1},8,["cardTitle","cardImage","cardPath"])):c("",!0),n(x,{class:"fast-item fast-item--cart",onClick:k.onTargetCart},{default:l((()=>[h.cartTotal>0?(a(),s(x,{key:0,class:"fast-badge fast-badge--fixed"},{default:l((()=>[d(i(h.cartTotal>99?"99+":h.cartTotal),1)])),_:1})):c("",!0),n(x,{class:"fast-icon"},{default:l((()=>[n(C,{class:"iconfont icon-gouwuche"})])),_:1}),n(x,{class:"fast-text"},{default:l((()=>[n(C,null,{default:l((()=>[d("购物车")])),_:1})])),_:1})])),_:1},8,["onClick"])])),_:1}),n(x,{class:"foo-item-btn"},{default:l((()=>[n(x,{class:"btn-wrapper"},{default:l((()=>[h.isEnableCart?(a(),s(x,{key:0,class:"btn-item btn-item-deputy",onClick:t[3]||(t[3]=e=>k.onShowSkuPopup(2))},{default:l((()=>[n(C,null,{default:l((()=>[d("加入购物车")])),_:1})])),_:1})):c("",!0),n(x,{class:"btn-item btn-item-main",onClick:t[4]||(t[4]=e=>k.onShowSkuPopup(3))},{default:l((()=>[n(C,null,{default:l((()=>[d("立即购买")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),n($,{modelValue:h.showShareSheet,"onUpdate:modelValue":t[5]||(t[5]=e=>h.showShareSheet=e),shareTitle:h.goods.goods_name,shareImageUrl:h.goods.goods_image},null,8,["modelValue","shareTitle","shareImageUrl"])])),_:1},8,["style"])),[[L,!h.isLoading]])}],["__scopeId","data-v-260d4966"]]);export{F as default};
