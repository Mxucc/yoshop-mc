import{E as e,$ as t,r as a,o as s,c as l,w as o,a as n,b as i,d,F as c,e as r,i as u,f as h,t as m,g,h as p,n as y,j as f,k as _,l as C,m as S,p as k,s as I,q as L,u as v,v as b,x,y as E}from"./index-BRq6JGeD.js";import{S as P}from"./index.CRSpmrfW.js";import{E as w}from"./index.DPGDlYFD.js";import{_ as T}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{M as A,_ as R}from"./mescroll-mixins.bvEc80FD.js";import{r as O}from"./uni-app.es.eRxYrI1e.js";import{A as G}from"./index.CoeNstdz.js";import{l as B}from"./index.Dyev38lT.js";import"./index.CD8gkcm5.js";import"./cart.B3GP1kqe.js";const N={onPageScroll(e){this.handlePageScroll(e)},onReachBottom(){this.handleReachBottom()},onPullDownRefresh(){this.handlePullDownRefresh()},data(){return{mescroll:{onPageScroll:e=>{this.handlePageScroll(e)},onReachBottom:()=>{this.handleReachBottom()},onPullDownRefresh:()=>{this.handlePullDownRefresh()}}}},methods:{handlePageScroll(e){let t=this.$refs.mescrollItem;t&&t.mescroll&&t.mescroll.onPageScroll(e)},handleReachBottom(){let e=this.$refs.mescrollItem;e&&e.mescroll&&e.mescroll.onReachBottom()},handlePullDownRefresh(){let e=this.$refs.mescrollItem;e&&e.mescroll&&e.mescroll.onPullDownRefresh()}}},j=new e([{key:"ONE_LEVEL_BIG",name:"一级分类[大图]",value:10},{key:"ONE_LEVEL_SMALL",name:"一级分类[小图]",value:11},{key:"TWO_LEVEL",name:"二级分类",value:20},{key:"COMMODITY",name:"一级分类+商品",value:30}]),$="category/list";let D;const M=T({components:{Search:P,Primary:T({components:{Empty:w},props:{display:{type:Number,default:10},list:{type:Array,default:[]}},data:()=>({PageCategoryStyleEnum:j}),methods:{onTargetGoodsList(e){this.$navTo("pages/goods/list",{categoryId:e})}}},[["render",function(e,t,p,y,f,_){const C=g,S=u,k=a("empty");return s(),l(S,{class:"primary"},{default:o((()=>[p.list.length>0&&p.display==f.PageCategoryStyleEnum.ONE_LEVEL_BIG.value?(s(),l(S,{key:0,class:"cate-content"},{default:o((()=>[n(S,{class:"cate-wrapper cate_style__10 clearfix"},{default:o((()=>[(s(!0),i(c,null,d(p.list,((e,t)=>(s(),l(S,{class:"cate-item",key:t,onClick:t=>_.onTargetGoodsList(e.category_id)},{default:o((()=>[e.image?(s(),l(C,{key:0,class:"image",mode:"widthFix",src:e.image.preview_url},null,8,["src"])):r("",!0)])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1})):r("",!0),p.list.length>0&&p.display==f.PageCategoryStyleEnum.ONE_LEVEL_SMALL.value?(s(),l(S,{key:1,class:"cate-content"},{default:o((()=>[n(S,{class:"cate-wrapper cate_style__11 clearfix"},{default:o((()=>[(s(!0),i(c,null,d(p.list,((e,t)=>(s(),l(S,{class:"cate-item",key:t,onClick:t=>_.onTargetGoodsList(e.category_id)},{default:o((()=>[e.image?(s(),l(C,{key:0,class:"image",mode:"scaleToFill",src:e.image.preview_url},null,8,["src"])):r("",!0),n(S,{class:"cate-name"},{default:o((()=>[h(m(e.name),1)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1})):r("",!0),p.list.length?r("",!0):(s(),l(k,{key:2,tips:"亲，暂无商品分类"+p.display},null,8,["tips"]))])),_:1})}],["__scopeId","data-v-7fa83826"]]),Secondary:T({props:{list:{type:Array,default:[]}},data:()=>({curIndex:0}),methods:{handleSelectNav(e){this.curIndex=e},handleGoods(e){this.$navTo("pages/goods/list",{categoryId:e})}}},[["render",function(e,t,a,S,k,I){const L=C,v=f,b=g,x=u;return s(),l(x,{class:"container",style:y(e.appThemeStyle)},{default:o((()=>[n(v,{class:"cate-left","scroll-y":!0,onTouchmove:t[0]||(t[0]=p((()=>{}),["stop","prevent"]))},{default:o((()=>[(s(!0),i(c,null,d(a.list,((e,t)=>(s(),l(L,{class:_(["type-nav",{selected:k.curIndex==t}]),key:t,onClick:e=>I.handleSelectNav(t)},{default:o((()=>[h(m(e.name),1)])),_:2},1032,["class","onClick"])))),128))])),_:1}),n(x,{class:"cate-content"},{default:o((()=>[n(x,{class:"category-list clearfix"},{default:o((()=>[(s(!0),i(c,null,d(a.list[k.curIndex].children,((e,t)=>(s(),l(x,{class:"category-item",key:t,onClick:t=>I.handleGoods(e.category_id)},{default:o((()=>[e.image?(s(),l(x,{key:0,class:"item-image"},{default:o((()=>[n(b,{class:"image",mode:"scaleToFill",src:e.image.preview_url},null,8,["src"])])),_:2},1024)):r("",!0),n(x,{class:"item-name"},{default:o((()=>[n(L,{class:"oneline-hide"},{default:o((()=>[h(m(e.name),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1})])),_:1},8,["style"])}],["__scopeId","data-v-acb73299"]]),Commodity:T({components:{AddCartBtn:T({props:{btnStyle:{type:Number,default:1}},data:()=>({value:!1,goodsInfo:{}}),methods:{handleAddCart(){this.$emit("handleAddCart")}}},[["render",function(e,t,a,i,d,c){const r=C,h=u;return s(),l(h,{class:"add-cart",onClick:p(c.handleAddCart,["stop"])},{default:o((()=>[n(r,{class:_(["icon iconfont",[`icon-jiagou${a.btnStyle}`]])},null,8,["class"])])),_:1},8,["onClick"])}],["__scopeId","data-v-6f7e15e6"]]),AddCartPopup:G},mixins:[A],props:{list:{type:Array,default:[]},setting:{type:Object,default:()=>{}}},data:()=>({curIndex:-1,showSubCate:!1,curIndex2:-1,goodsList:S(),upOption:{auto:!0,page:{size:15},noMoreSize:3,toTop:{right:30,bottom:48,zIndex:9}}}),computed:{subCateList(){return this.list[this.curIndex]&&this.list[this.curIndex].children?this.list[this.curIndex].children:[]}},methods:{upCallback(e){const t=this;t.getGoodsList(e.num).then((e=>{const a=e.data.length,s=e.data.total;t.mescroll.endBySize(a,s)})).catch((()=>t.mescroll.endErr()))},getGoodsList(e=1){const t=this,a=t.getCategoryId();return new Promise(((s,l)=>{B({categoryId:a,page:e},{load:!1}).then((a=>{const l=a.data.list;t.goodsList.data=k(l,t.goodsList,e),t.goodsList.last_page=l.last_page,s(l)})).catch(l)}))},getCategoryId(){const e=this;return e.curIndex2>-1?e.subCateList[e.curIndex2].category_id:e.curIndex>-1?e.list[e.curIndex].category_id:0},handleSelectNav(e){this.curIndex=e,this.onRefreshList(),this.showSubCate=!1,this.curIndex2=-1},handleSelectSubCate(e){this.curIndex2=e,this.showSubCate=!1,this.onRefreshList()},onRefreshList(){this.goodsList=S(),setTimeout((()=>this.mescroll.resetUpScroll()),120)},onTargetGoods(e){this.$navTo("pages/goods/detail",{goodsId:e})},handleAddCart(e){this.$refs.AddCartPopup.handle(e)},onUpdateCartTabBadge(){console.log("onUpdateCartTabBadge"),I()},handleShowSubCate(){this.showSubCate=!this.showSubCate}}},[["render",function(e,t,S,k,I,x){const E=C,P=f,w=u,T=g,A=a("add-cart-btn"),G=a("AddCartPopup"),B=O(L("mescroll-body"),R);return s(),l(w,{class:"container",style:y(e.appThemeStyle)},{default:o((()=>[n(P,{class:"cate-left","scroll-y":!0,onTouchmove:t[1]||(t[1]=p((()=>{}),["stop","prevent"]))},{default:o((()=>[n(E,{class:_(["type-nav",{selected:-1==I.curIndex}]),onClick:t[0]||(t[0]=e=>x.handleSelectNav(-1))},{default:o((()=>[h("全部")])),_:1},8,["class"]),(s(!0),i(c,null,d(S.list,((e,t)=>(s(),l(E,{class:_(["type-nav",{selected:I.curIndex==t}]),key:t,onClick:e=>x.handleSelectNav(t)},{default:o((()=>[h(m(e.name),1)])),_:2},1032,["class","onClick"])))),128))])),_:1}),n(B,{ref:"mescrollRef",sticky:!0,onInit:e.mescrollInit,down:{use:!1},up:I.upOption,bottombar:!1,onUp:x.upCallback},{default:o((()=>[n(w,{class:"cate-content"},{default:o((()=>[x.subCateList.length?(s(),l(w,{key:0,class:_(["sub-cate-list clearfix",{"display-fold":!I.showSubCate}]),onTouchmove:t[3]||(t[3]=p((()=>{}),["stop","prevent"]))},{default:o((()=>[n(w,{class:"nav-icon",onClick:x.handleShowSubCate},{default:o((()=>[n(E,{class:_(["iconfont",[I.showSubCate?"icon-arrow-up":"icon-arrow-down"]])},null,8,["class"])])),_:1},8,["onClick"]),n(w,{class:_(["sub-cate-item",{selected:-1==I.curIndex2}]),onClick:t[2]||(t[2]=e=>x.handleSelectSubCate(-1))},{default:o((()=>[n(E,null,{default:o((()=>[h("全部")])),_:1})])),_:1},8,["class"]),(s(!0),i(c,null,d(x.subCateList,((e,t)=>(s(),l(w,{class:_(["sub-cate-item",{selected:I.curIndex2==t}]),key:t,onClick:e=>x.handleSelectSubCate(t)},{default:o((()=>[n(E,null,{default:o((()=>[h(m(e.name),1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))])),_:1},8,["class"])):r("",!0),n(w,{class:"goods-list"},{default:o((()=>[(s(!0),i(c,null,d(I.goodsList.data,((e,t)=>(s(),l(w,{class:"goods-item--container",key:t},{default:o((()=>[n(w,{class:"goods-item",onClick:t=>x.onTargetGoods(e.goods_id)},{default:o((()=>[n(w,{class:"goods-item-left"},{default:o((()=>[n(T,{class:"image",src:e.goods_image},null,8,["src"])])),_:2},1024),n(w,{class:"goods-item-right"},{default:o((()=>[n(w,{class:"goods-name"},{default:o((()=>[n(E,{class:"twoline-hide"},{default:o((()=>[h(m(e.goods_name),1)])),_:2},1024)])),_:2},1024),n(w,{class:"goods-item-desc"},{default:o((()=>[n(w,{class:"desc-footer"},{default:o((()=>[n(w,{class:"item-prices oneline-hide"},{default:o((()=>[n(E,{class:"price-x"},{default:o((()=>[h("¥"+m(e.goods_price_min),1)])),_:2},1024),e.line_price_min>0?(s(),l(E,{key:0,class:"price-y"},{default:o((()=>[h("¥"+m(e.line_price_min),1)])),_:2},1024)):r("",!0)])),_:2},1024),S.setting.showAddCart?(s(),l(A,{key:0,btnStyle:S.setting.cartStyle,onHandleAddCart:t=>x.handleAddCart(e)},null,8,["btnStyle","onHandleAddCart"])):r("",!0)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])])),_:2},1024)))),128))])),_:1}),v(n(w,{class:"mask",onTouchmove:t[4]||(t[4]=p((()=>{}),["stop","prevent"])),onClick:x.handleShowSubCate},null,8,["onClick"]),[[b,I.showSubCate]]),n(G,{ref:"AddCartPopup",onAddCart:x.onUpdateCartTabBadge},null,8,["onAddCart"])])),_:1})])),_:1},8,["onInit","up","onUp"])])),_:1},8,["style"])}],["__scopeId","data-v-4517ccf6"]])},mixins:[N],data:()=>({PageCategoryStyleEnum:j,list:[],setting:{},isLoading:!0}),onLoad(){this.onRefreshPage()},onShow(){(new Date).getTime()-D>3e5&&this.onRefreshPage()},methods:{onRefreshPage(){D=(new Date).getTime(),this.getPageData(),I()},getPageData(){const e=this;e.isLoading=!0,Promise.all([x.data(!1),t.get($)]).then((t=>{e.initSetting(t[0]),e.initCategory(t[1])})).finally((()=>e.isLoading=!1))},initSetting(e){this.setting=e[E.PAGE_CATEGORY_TEMPLATE.value]},initCategory(e){this.list=e.data.list}},onShareAppMessage(){return{title:_this.templet.shareTitle,path:"/pages/category/index?"+this.$getShareUrlParams()}},onShareTimeline(){return{title:_this.templet.shareTitle,path:"/pages/category/index?"+this.$getShareUrlParams()}}},[["render",function(e,t,i,d,c,h){const m=a("search"),g=u,p=a("primary"),y=a("secondary"),f=a("commodity");return s(),l(g,{class:"container"},{default:o((()=>[n(g,{class:"search"},{default:o((()=>[n(m,{tips:"搜索商品",onEvent:t[0]||(t[0]=t=>e.$navTo("pages/search/index"))})])),_:1}),c.setting.style==c.PageCategoryStyleEnum.ONE_LEVEL_BIG.value||c.setting.style==c.PageCategoryStyleEnum.ONE_LEVEL_SMALL.value?(s(),l(p,{key:0,display:c.setting.style,list:c.list},null,8,["display","list"])):r("",!0),c.setting.style==c.PageCategoryStyleEnum.TWO_LEVEL.value?(s(),l(y,{key:1,list:c.list},null,8,["list"])):r("",!0),c.setting.style==c.PageCategoryStyleEnum.COMMODITY.value?(s(),l(f,{key:2,ref:"mescrollItem",list:c.list,setting:c.setting},null,8,["list","setting"])):r("",!0)])),_:1})}],["__scopeId","data-v-509b1f2b"]]);export{M as default};
