import{_ as e}from"./u-tabs.ac16122d.js";import{q as t,u as a,o as s,c as l,w as o,n,i,a as r,b as u,d,F as c,y as m,f as _,t as f,e as p,l as h,g}from"./index-3b24b149.js";import{r as y}from"./uni-app.es.9206f90a.js";import{M as v,_ as C}from"./mescroll-mixins.57cfe76c.js";import{a as E,D as T,b,P as k,R as S}from"./OrderType.2c504bdd.js";import{l as R,c as D,r as L}from"./order.69539734.js";import{_ as I}from"./_plugin-vue_export-helper.1b428a4d.js";const P=[{name:"全部",value:"all"},{name:"待支付",value:"payment"},{name:"待发货",value:"delivery"},{name:"待收货",value:"received"},{name:"待评价",value:"comment"}];const x=I({mixins:[v],data:()=>({DeliveryStatusEnum:E,DeliveryTypeEnum:T,OrderStatusEnum:b,PayStatusEnum:k,ReceiptStatusEnum:S,options:{dataType:"all"},tabs:P,curTab:0,list:t(),upOption:{auto:!0,page:{size:15},noMoreSize:4,empty:{tip:"亲，暂无订单记录"}},canReset:!1}),onLoad(e){this.initCurTab(e),uni.$on("syncRefresh",(e=>{this.canReset=e}))},onShow(){this.canReset&&this.onRefreshList(),this.canReset=!1},onUnload(){uni.$off("syncRefresh")},methods:{initCurTab(e){const t=this;if(e.dataType){const a=t.tabs.findIndex((t=>t.value==e.dataType));t.curTab=a>-1?a:0}},upCallback(e){const t=this;t.getOrderList(e.num).then((e=>{const a=e.data.length,s=e.data.total;t.mescroll.endBySize(a,s)})).catch((()=>t.mescroll.endErr()))},getOrderList(e=1){const t=this;return new Promise(((s,l)=>{R({dataType:t.getTabValue(),page:e},{load:!1}).then((l=>{const o=t.initList(l.data.list);t.list.data=a(o,t.list,e),s(o)}))}))},initList:e=>(e.data.forEach((e=>{e.total_num=0,e.goods.forEach((t=>{e.total_num+=t.total_num}))})),e),getTabValue(){return this.tabs[this.curTab].value},onChangeTab(e){this.curTab=e,this.onRefreshList()},onRefreshList(){this.list=t(),setTimeout((()=>{this.mescroll.resetUpScroll()}),120)},onCancel(e){const t=this;uni.showModal({title:"友情提示",content:"确认要取消该订单吗？",success(a){a.confirm&&D(e).then((e=>{t.$toast(e.message),t.onRefreshList()}))}})},onReceipt(e){const t=this;uni.showModal({title:"友情提示",content:"确认收到商品了吗？",success(a){a.confirm&&L(e).then((e=>{t.$success(e.message),t.onRefreshList()}))}})},onPay(e){this.$navTo("pages/checkout/cashier/index",{orderId:e})},handleTargetDetail(e){this.$navTo("pages/order/detail",{orderId:e})},handleTargetComment(e){this.$navTo("pages/order/comment/index",{orderId:e})}}},[["render",function(t,a,v,E,T,b){const k=y(m("u-tabs"),e),S=h,R=i,D=g,L=y(m("mescroll-body"),C);return s(),l(R,{class:"container",style:n(t.appThemeStyle)},{default:o((()=>[r(L,{ref:"mescrollRef",sticky:!0,onInit:t.mescrollInit,down:{native:!0},onDown:t.downCallback,up:T.upOption,onUp:b.upCallback},{default:o((()=>[r(k,{list:T.tabs,"is-scroll":!1,current:T.curTab,"active-color":t.appTheme.mainBg,duration:.2,onChange:b.onChangeTab},null,8,["list","current","active-color","duration","onChange"]),r(R,{class:"order-list"},{default:o((()=>[(s(!0),u(c,null,d(T.list.data,((e,t)=>(s(),l(R,{class:"order-item",key:t},{default:o((()=>[r(R,{class:"item-top"},{default:o((()=>[r(R,{class:"item-top-left"},{default:o((()=>[r(S,{class:"order-time"},{default:o((()=>[_(f(e.create_time),1)])),_:2},1024)])),_:2},1024),r(R,{class:"item-top-right"},{default:o((()=>[r(S,{class:"state-text"},{default:o((()=>[_(f(e.state_text),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),r(R,{class:"goods-list",onClick:t=>b.handleTargetDetail(e.order_id)},{default:o((()=>[(s(!0),u(c,null,d(e.goods,((e,t)=>(s(),l(R,{class:"goods-item",key:t},{default:o((()=>[r(R,{class:"goods-image"},{default:o((()=>[r(D,{class:"image",src:e.goods_image,mode:"scaleToFill"},null,8,["src"])])),_:2},1024),r(R,{class:"goods-content"},{default:o((()=>[r(R,{class:"goods-title"},{default:o((()=>[r(S,{class:"twoline-hide"},{default:o((()=>[_(f(e.goods_name),1)])),_:2},1024)])),_:2},1024),r(R,{class:"goods-props clearfix"},{default:o((()=>[(s(!0),u(c,null,d(e.goods_props,((e,t)=>(s(),l(R,{class:"goods-props-item",key:t},{default:o((()=>[r(S,null,{default:o((()=>[_(f(e.value.name),1)])),_:2},1024)])),_:2},1024)))),128))])),_:2},1024)])),_:2},1024),r(R,{class:"goods-trade"},{default:o((()=>[r(R,{class:"goods-price"},{default:o((()=>[r(S,{class:"unit"},{default:o((()=>[_("￥")])),_:1}),r(S,{class:"value"},{default:o((()=>[_(f(e.is_user_grade?e.grade_goods_price:e.goods_price),1)])),_:2},1024)])),_:2},1024),r(R,{class:"goods-num"},{default:o((()=>[r(S,null,{default:o((()=>[_("×"+f(e.total_num),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:2},1032,["onClick"]),r(R,{class:"order-total"},{default:o((()=>[r(S,null,{default:o((()=>[_("共"+f(e.total_num)+"件商品，总金额",1)])),_:2},1024),r(S,{class:"unit"},{default:o((()=>[_("￥")])),_:1}),r(S,{class:"money"},{default:o((()=>[_(f(e.pay_price),1)])),_:2},1024)])),_:2},1024),e.order_status!=T.OrderStatusEnum.CANCELLED.value?(s(),l(R,{key:0,class:"order-handle"},{default:o((()=>[r(R,{class:"btn-group clearfix"},{default:o((()=>[e.pay_status==T.PayStatusEnum.PENDING.value?(s(),l(R,{key:0,class:"btn-item",onClick:t=>b.onCancel(e.order_id)},{default:o((()=>[_("取消")])),_:2},1032,["onClick"])):p("",!0),e.order_status!=T.OrderStatusEnum.APPLY_CANCEL.value?(s(),u(c,{key:1},[e.pay_status==T.PayStatusEnum.SUCCESS.value&&e.delivery_status==T.DeliveryStatusEnum.NOT_DELIVERED.value?(s(),l(R,{key:0,class:"btn-item",onClick:t=>b.onCancel(e.order_id)},{default:o((()=>[_("申请取消")])),_:2},1032,["onClick"])):p("",!0)],64)):(s(),l(R,{key:2,class:"f-28 col-8"},{default:o((()=>[_("取消申请中")])),_:1})),e.pay_status==T.PayStatusEnum.PENDING.value?(s(),l(R,{key:3,class:"btn-item active",onClick:t=>b.onPay(e.order_id)},{default:o((()=>[_("去支付")])),_:2},1032,["onClick"])):p("",!0),e.delivery_status==T.DeliveryStatusEnum.DELIVERED.value&&e.receipt_status==T.ReceiptStatusEnum.NOT_RECEIVED.value?(s(),l(R,{key:4,class:"btn-item active",onClick:t=>b.onReceipt(e.order_id)},{default:o((()=>[_("确认收货")])),_:2},1032,["onClick"])):p("",!0),e.order_status==T.OrderStatusEnum.COMPLETED.value&&0==e.is_comment?(s(),l(R,{key:5,class:"btn-item",onClick:t=>b.handleTargetComment(e.order_id)},{default:o((()=>[_("评价")])),_:2},1032,["onClick"])):p("",!0)])),_:2},1024)])),_:2},1024)):p("",!0)])),_:2},1024)))),128))])),_:1})])),_:1},8,["onInit","onDown","up","onUp"])])),_:1},8,["style"])}],["__scopeId","data-v-d4e2ad74"]]);export{x as default};
