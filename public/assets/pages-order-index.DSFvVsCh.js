import{_ as e}from"./u-tabs.1jldnv9_.js";import{m as t,p as a,q as s,c as l,w as o,n,i,o as r,a as u,b as d,d as c,F as m,f as _,t as p,e as f,l as h,g as y}from"./index-BRq6JGeD.js";import{r as g}from"./uni-app.es.eRxYrI1e.js";import{M as v,_ as E}from"./mescroll-mixins.bvEc80FD.js";import{a as C,D as T,b,P as k,R}from"./OrderType.U2oC19FJ.js";import{C as S}from"./Client.CIlnbTOg.js";import{l as D,c as I,r as L}from"./order.DlJmvuT2.js";import{_ as P}from"./_plugin-vue_export-helper.BCo6x5W8.js";const x=[{name:"全部",value:"all"},{name:"待支付",value:"payment"},{name:"待发货",value:"delivery"},{name:"待收货",value:"received"},{name:"待评价",value:"comment"}];const O=P({mixins:[v],data:()=>({DeliveryStatusEnum:C,DeliveryTypeEnum:T,OrderStatusEnum:b,PayStatusEnum:k,ReceiptStatusEnum:R,options:{dataType:"all"},tabs:x,curTab:0,list:t(),upOption:{auto:!0,page:{size:15},noMoreSize:4,empty:{tip:"亲，暂无订单记录"}},canReset:!1}),onLoad(e){this.initCurTab(e),uni.$on("syncRefresh",(e=>{this.canReset=e}))},onUnload(){},onShow(){this.canReset&&this.onRefreshList(),this.canReset=!1},onUnload(){uni.$off("syncRefresh")},methods:{initCurTab(e){const t=this;if(e.dataType){const a=t.tabs.findIndex((t=>t.value==e.dataType));t.curTab=a>-1?a:0}},upCallback(e){const t=this;t.getOrderList(e.num).then((e=>{const a=e.data.length,s=e.data.total;t.mescroll.endBySize(a,s)})).catch((()=>t.mescroll.endErr()))},getOrderList(e=1){const t=this;return new Promise(((s,l)=>{D({dataType:t.getTabValue(),page:e},{load:!1}).then((l=>{const o=t.initList(l.data.list);t.list.data=a(o,t.list,e),s(o)}))}))},initList:e=>(e.data.forEach((e=>{e.total_num=0,e.goods.forEach((t=>{e.total_num+=t.total_num}))})),e),getTabValue(){return this.tabs[this.curTab].value},onChangeTab(e){this.curTab=e,this.onRefreshList()},onRefreshList(){this.list=t(),setTimeout((()=>{this.mescroll.resetUpScroll()}),120)},onCancel(e){const t=this;uni.showModal({title:"友情提示",content:"确认要取消该订单吗？",success(a){a.confirm&&I(e).then((e=>{t.$toast(e.message),t.onRefreshList()}))}})},async onReceipt(e){const t=this,a=t.list.data[e];t.platform===S.MP_WEIXIN.value&&a.sync_weixin_shipping&&a.pay_method===PayMethodEnum.WECHAT.value&&a.platform===S.MP_WEIXIN.value||t.receiptModal(a.order_id)},receiptModal(e){const t=this;uni.showModal({title:"友情提示",content:"确认收到商品了吗？",success(a){a.confirm&&t.receiptEvent(e)}})},receiptEvent(e){const t=this;L(e).then((e=>{t.$success(e.message),t.onRefreshList()}))},onPay(e){this.$navTo("pages/checkout/cashier/index",{orderId:e})},handleTargetDetail(e){this.$navTo("pages/order/detail",{orderId:e})},handleTargetComment(e){this.$navTo("pages/order/comment/index",{orderId:e})}}},[["render",function(t,a,v,C,T,b){const k=g(s("u-tabs"),e),R=h,S=i,D=y,I=g(s("mescroll-body"),E);return r(),l(S,{class:"container",style:n(t.appThemeStyle)},{default:o((()=>[u(I,{ref:"mescrollRef",sticky:!0,onInit:t.mescrollInit,down:{native:!0},onDown:t.downCallback,up:T.upOption,onUp:b.upCallback},{default:o((()=>[u(k,{list:T.tabs,"is-scroll":!1,modelValue:T.curTab,"onUpdate:modelValue":a[0]||(a[0]=e=>T.curTab=e),"active-color":t.appTheme.mainBg,duration:.2,onChange:b.onChangeTab},null,8,["list","modelValue","active-color","onChange"]),u(S,{class:"order-list"},{default:o((()=>[(r(!0),d(m,null,c(T.list.data,((e,t)=>(r(),l(S,{class:"order-item",key:t},{default:o((()=>[u(S,{class:"item-top"},{default:o((()=>[u(S,{class:"item-top-left"},{default:o((()=>[u(R,{class:"order-time"},{default:o((()=>[_(p(e.create_time),1)])),_:2},1024)])),_:2},1024),u(S,{class:"item-top-right"},{default:o((()=>[u(R,{class:"state-text"},{default:o((()=>[_(p(e.state_text),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),u(S,{class:"goods-list",onClick:t=>b.handleTargetDetail(e.order_id)},{default:o((()=>[(r(!0),d(m,null,c(e.goods,((e,t)=>(r(),l(S,{class:"goods-item",key:t},{default:o((()=>[u(S,{class:"goods-image"},{default:o((()=>[u(D,{class:"image",src:e.goods_image,mode:"scaleToFill"},null,8,["src"])])),_:2},1024),u(S,{class:"goods-content"},{default:o((()=>[u(S,{class:"goods-title"},{default:o((()=>[u(R,{class:"twoline-hide"},{default:o((()=>[_(p(e.goods_name),1)])),_:2},1024)])),_:2},1024),u(S,{class:"goods-props clearfix"},{default:o((()=>[(r(!0),d(m,null,c(e.goods_props,((e,t)=>(r(),l(S,{class:"goods-props-item",key:t},{default:o((()=>[u(R,null,{default:o((()=>[_(p(e.value.name),1)])),_:2},1024)])),_:2},1024)))),128))])),_:2},1024)])),_:2},1024),u(S,{class:"goods-trade"},{default:o((()=>[u(S,{class:"goods-price"},{default:o((()=>[u(R,{class:"unit"},{default:o((()=>[_("￥")])),_:1}),u(R,{class:"value"},{default:o((()=>[_(p(e.is_user_grade?e.grade_goods_price:e.goods_price),1)])),_:2},1024)])),_:2},1024),u(S,{class:"goods-num"},{default:o((()=>[u(R,null,{default:o((()=>[_("×"+p(e.total_num),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:2},1032,["onClick"]),u(S,{class:"order-total"},{default:o((()=>[u(R,null,{default:o((()=>[_("共"+p(e.total_num)+"件商品，总金额",1)])),_:2},1024),u(R,{class:"unit"},{default:o((()=>[_("￥")])),_:1}),u(R,{class:"money"},{default:o((()=>[_(p(e.pay_price),1)])),_:2},1024)])),_:2},1024),e.order_status!=T.OrderStatusEnum.CANCELLED.value?(r(),l(S,{key:0,class:"order-handle"},{default:o((()=>[u(S,{class:"btn-group clearfix"},{default:o((()=>[e.pay_status==T.PayStatusEnum.PENDING.value?(r(),l(S,{key:0,class:"btn-item",onClick:t=>b.onCancel(e.order_id)},{default:o((()=>[_("取消")])),_:2},1032,["onClick"])):f("",!0),e.order_status!=T.OrderStatusEnum.APPLY_CANCEL.value?(r(),d(m,{key:1},[e.pay_status==T.PayStatusEnum.SUCCESS.value&&e.delivery_status==T.DeliveryStatusEnum.NOT_DELIVERED.value?(r(),l(S,{key:0,class:"btn-item",onClick:t=>b.onCancel(e.order_id)},{default:o((()=>[_("申请取消")])),_:2},1032,["onClick"])):f("",!0)],64)):(r(),l(S,{key:2,class:"f-28 col-8"},{default:o((()=>[_("取消申请中")])),_:1})),e.pay_status==T.PayStatusEnum.PENDING.value?(r(),l(S,{key:3,class:"btn-item active",onClick:t=>b.onPay(e.order_id)},{default:o((()=>[_("去支付")])),_:2},1032,["onClick"])):f("",!0),e.delivery_status==T.DeliveryStatusEnum.DELIVERED.value&&e.receipt_status==T.ReceiptStatusEnum.NOT_RECEIVED.value?(r(),l(S,{key:4,class:"btn-item active",onClick:e=>b.onReceipt(t)},{default:o((()=>[_("确认收货")])),_:2},1032,["onClick"])):f("",!0),e.order_status==T.OrderStatusEnum.COMPLETED.value&&0==e.is_comment?(r(),l(S,{key:5,class:"btn-item",onClick:t=>b.handleTargetComment(e.order_id)},{default:o((()=>[_("评价")])),_:2},1032,["onClick"])):f("",!0)])),_:2},1024)])),_:2},1024)):f("",!0)])),_:2},1024)))),128))])),_:1})])),_:1},8,["onInit","onDown","up","onUp"])])),_:1},8,["style"])}],["__scopeId","data-v-62154c90"]]);export{O as default};
