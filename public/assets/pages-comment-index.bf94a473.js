import{_ as e}from"./u-tabs.ac16122d.js";import{q as a,u as s,o as t,c as o,w as l,n as r,i as n,a as i,b as c,d as m,F as u,y as d,r as p,f as g,t as f,e as h,l as _,g as T}from"./index-3b24b149.js";import{r as b}from"./uni-app.es.9206f90a.js";import{a as y,t as v,_ as I}from"./comment.a825bfb3.js";import{M as C,_ as k}from"./mescroll-mixins.57cfe76c.js";import{A as w}from"./index.f29cfa79.js";import{_ as x}from"./_plugin-vue_export-helper.1b428a4d.js";import"./u-icon.72a24694.js";const j=[{name:"全部",scoreType:-1},{name:"好评",scoreType:10},{name:"中评",scoreType:20},{name:"差评",scoreType:30}];const S=x({components:{AvatarImage:w},mixins:[C],data:()=>({goodsId:null,curTab:0,list:a(),total:{all:0,negative:0,praise:0,review:0},rates:{10:5,20:3,30:1},tabs:j,upOption:{auto:!0,page:{size:15},noMoreSize:4,empty:{tip:"亲，暂无相关商品评价"}}}),onLoad(e){this.goodsId=e.goodsId,this.getTotal()},methods:{upCallback(e){const a=this;a.getCommentList(e.num).then((e=>{const s=e.data.length,t=e.data.total;a.mescroll.endBySize(s,t)})).catch((()=>a.mescroll.endErr()))},getCommentList(e=1){const a=this;return new Promise(((t,o)=>{y(a.goodsId,{scoreType:a.getScoreType(),page:e},{load:!1}).then((o=>{const l=o.data.list;a.list.data=s(l,a.list,e),t(l)}))}))},getScoreType(){return this.tabs[this.curTab].scoreType},getTotal(){const e=this;v(e.goodsId).then((a=>{const s=a.data.total;e.getTabs(s)}))},getTabs(e){const a=this.tabs;a[0].name=`全部(${e.all})`,a[1].name=`好评(${e.praise})`,a[2].name=`中评(${e.review})`,a[3].name=`差评(${e.negative})`},onChangeTab(e){this.curTab=e,this.onRefreshList()},onRefreshList(){this.list=a(),setTimeout((()=>{this.mescroll.resetUpScroll()}),120)},onPreviewImages(e,a){const s=this.list.data[e].images.map((e=>e.image_url));uni.previewImage({current:s[a],urls:s})}}},[["render",function(a,s,y,v,C,w){const x=b(d("u-tabs"),e),j=p("avatar-image"),S=n,L=_,$=b(d("u-rate"),I),z=T,O=b(d("mescroll-body"),k);return t(),o(S,{class:"container",style:r(a.appThemeStyle)},{default:l((()=>[i(O,{ref:"mescrollRef",sticky:!0,onInit:a.mescrollInit,down:{use:!1},up:C.upOption,onUp:w.upCallback},{default:l((()=>[i(x,{list:C.tabs,"is-scroll":!1,current:C.curTab,"active-color":a.appTheme.mainBg,duration:.2,onChange:w.onChangeTab},null,8,["list","current","active-color","duration","onChange"]),i(S,{class:"comment-list"},{default:l((()=>[(t(!0),c(u,null,m(C.list.data,((e,a)=>(t(),o(S,{class:"comment-item",key:a},{default:l((()=>[i(S,{class:"item-head"},{default:l((()=>[i(S,{class:"user-info"},{default:l((()=>[i(S,{class:"user-avatar"},{default:l((()=>[i(j,{url:e.user.avatar_url,width:50},null,8,["url"])])),_:2},1024),i(L,{class:"user-name f-26"},{default:l((()=>[g(f(e.user.nick_name),1)])),_:2},1024)])),_:2},1024),i($,{"active-color":"#f4a213",current:C.rates[e.score],disabled:!0},null,8,["current"]),i(S,{class:"flex-box f-22 col-9 t-r"},{default:l((()=>[g(f(e.create_time),1)])),_:2},1024)])),_:2},1024),i(S,{class:"item-content m-top20"},{default:l((()=>[i(L,{class:"f-26"},{default:l((()=>[g(f(e.content),1)])),_:2},1024)])),_:2},1024),e.images.length?(t(),o(S,{key:0,class:"images-list clearfix"},{default:l((()=>[(t(!0),c(u,null,m(e.images,((e,s)=>(t(),o(S,{class:"image-preview",key:s},{default:l((()=>[i(z,{class:"image",mode:"aspectFill",src:e.image_url,onClick:e=>w.onPreviewImages(a,s)},null,8,["src","onClick"])])),_:2},1024)))),128))])),_:2},1024)):h("",!0),i(S,{class:"goods-props clearfix"},{default:l((()=>[(t(!0),c(u,null,m(e.orderGoods.goods_props,((e,a)=>(t(),o(S,{class:"goods-props-item",key:a},{default:l((()=>[i(L,{class:"group-name"},{default:l((()=>[g(f(e.group.name)+": ",1)])),_:2},1024),i(L,null,{default:l((()=>[g(f(e.value.name)+"；",1)])),_:2},1024)])),_:2},1024)))),128))])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1},8,["onInit","up","onUp"])])),_:1},8,["style"])}],["__scopeId","data-v-cf04de30"]]);export{S as default};
